================================================================================
JobID = 1500171
User = u11448, Account = nhr_dnlpss24_g04
Partition = grete, Nodelist = ggpu153
================================================================================
Submitting job with sbatch from directory: /home/mohamed.aly/u11448/DeepLearning4NLP
Home directory: /user/mohamed.aly/u11448
Working directory: /home/mohamed.aly/u11448/DeepLearning4NLP
Current node: ggpu153
Python 3.10.14
Collecting environment information...
PyTorch version: 2.2.0
Is debug build: False
CUDA used to build PyTorch: 12.1
ROCM used to build PyTorch: N/A

OS: Rocky Linux 8.8 (Green Obsidian) (x86_64)
GCC version: (GCC) 8.5.0 20210514 (Red Hat 8.5.0-18)
Clang version: Could not collect
CMake version: version 3.27.4
Libc version: glibc-2.28

Python version: 3.10.14 (main, May  6 2024, 19:42:50) [GCC 11.2.0] (64-bit runtime)
Python platform: Linux-4.18.0-477.21.1.el8_8.x86_64-x86_64-with-glibc2.28
Is CUDA available: True
CUDA runtime version: Could not collect
CUDA_MODULE_LOADING set to: LAZY
GPU models and configuration: 
GPU 0: NVIDIA A100-SXM4-80GB
GPU 1: NVIDIA A100-SXM4-80GB
GPU 2: NVIDIA A100-SXM4-80GB
GPU 3: NVIDIA A100-SXM4-80GB

Nvidia driver version: 535.104.12
cuDNN version: Probably one of the following:
/usr/lib64/libcudnn.so.8.9.5
/usr/lib64/libcudnn_adv_infer.so.8.9.5
/usr/lib64/libcudnn_adv_train.so.8.9.5
/usr/lib64/libcudnn_cnn_infer.so.8.9.5
/usr/lib64/libcudnn_cnn_train.so.8.9.5
/usr/lib64/libcudnn_ops_infer.so.8.9.5
/usr/lib64/libcudnn_ops_train.so.8.9.5
HIP runtime version: N/A
MIOpen runtime version: N/A
Is XNNPACK available: True

CPU:
Architecture:        x86_64
CPU op-mode(s):      32-bit, 64-bit
Byte Order:          Little Endian
CPU(s):              128
On-line CPU(s) list: 0-127
Thread(s) per core:  2
Core(s) per socket:  32
Socket(s):           2
NUMA node(s):        8
Vendor ID:           AuthenticAMD
CPU family:          25
Model:               1
Model name:          AMD EPYC 7513 32-Core Processor
Stepping:            1
CPU MHz:             2600.000
CPU max MHz:         3681.6399
CPU min MHz:         1500.0000
BogoMIPS:            5199.81
Virtualization:      AMD-V
L1d cache:           32K
L1i cache:           32K
L2 cache:            512K
L3 cache:            32768K
NUMA node0 CPU(s):   0-7,64-71
NUMA node1 CPU(s):   8-15,72-79
NUMA node2 CPU(s):   16-23,80-87
NUMA node3 CPU(s):   24-31,88-95
NUMA node4 CPU(s):   32-39,96-103
NUMA node5 CPU(s):   40-47,104-111
NUMA node6 CPU(s):   48-55,112-119
NUMA node7 CPU(s):   56-63,120-127
Flags:               fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush mmx fxsr sse sse2 ht syscall nx mmxext fxsr_opt pdpe1gb rdtscp lm constant_tsc rep_good nopl nonstop_tsc cpuid extd_apicid aperfmperf pni pclmulqdq monitor ssse3 fma cx16 pcid sse4_1 sse4_2 movbe popcnt aes xsave avx f16c rdrand lahf_lm cmp_legacy svm extapic cr8_legacy abm sse4a misalignsse 3dnowprefetch osvw ibs skinit wdt tce topoext perfctr_core perfctr_nb bpext perfctr_llc mwaitx cpb cat_l3 cdp_l3 invpcid_single hw_pstate ssbd mba ibrs ibpb stibp vmmcall fsgsbase bmi1 avx2 smep bmi2 erms invpcid cqm rdt_a rdseed adx smap clflushopt clwb sha_ni xsaveopt xsavec xgetbv1 xsaves cqm_llc cqm_occup_llc cqm_mbm_total cqm_mbm_local clzero irperf xsaveerptr wbnoinvd amd_ppin brs arat npt lbrv svm_lock nrip_save tsc_scale vmcb_clean flushbyasid decodeassists pausefilter pfthreshold v_vmsave_vmload vgif v_spec_ctrl umip pku ospke vaes vpclmulqdq rdpid overflow_recov succor smca fsrm

Versions of relevant libraries:
[pip3] numpy==1.26.4
[pip3] pytorch-crf==0.7.2
[pip3] smart-pytorch==0.0.4
[pip3] torch==2.2.0
[pip3] torch-tb-profiler==0.4.3
[pip3] torchaudio==2.2.0
[pip3] torchvision==0.17.0
[pip3] triton==2.2.0
[conda] blas                      1.0                         mkl  
[conda] ffmpeg                    4.3                  hf484d3e_0    pytorch
[conda] libjpeg-turbo             2.0.0                h9bf148f_0    pytorch
[conda] mkl                       2023.1.0         h213fc3f_46344  
[conda] mkl-fft                   1.3.8                    pypi_0    pypi
[conda] mkl-random                1.2.4                    pypi_0    pypi
[conda] mkl-service               2.4.0                    pypi_0    pypi
[conda] mkl_fft                   1.3.8           py310h5eee18b_0  
[conda] mkl_random                1.2.4           py310hdb19cb5_0  
[conda] numpy                     1.26.4                   pypi_0    pypi
[conda] numpy-base                1.26.4          py310hb5e798b_0  
[conda] pytorch                   2.2.0           py3.10_cuda12.1_cudnn8.9.2_0    pytorch
[conda] pytorch-crf               0.7.2                    pypi_0    pypi
[conda] pytorch-cuda              12.1                 ha16c6d3_5    pytorch
[conda] pytorch-mutex             1.0                        cuda    pytorch
[conda] smart-pytorch             0.0.4                    pypi_0    pypi
[conda] torch                     2.2.0                    pypi_0    pypi
[conda] torch-tb-profiler         0.4.3                    pypi_0    pypi
[conda] torchaudio                2.2.0                    pypi_0    pypi
[conda] torchtriton               2.2.0                     py310    pytorch
[conda] torchvision               0.17.0                   pypi_0    pypi
[conda] triton                    2.2.0                    pypi_0    pypi

Current Branch: BERT_PALs-Aly
Latest Commit: e9f21d7
Uncommitted Changes: 16

[EXPERIMENTAL] PCGRAD & Vaccine use combine strategy
Loaded 7111 train examples from data/sst-sentiment-train.csv
Loaded 121620 train examples from data/quora-paraphrase-train.csv
Loaded 5149 train examples from data/sts-similarity-train.csv
Loaded 2365 train examples from data/sst-sentiment-dev.csv
Loaded 40540 train examples from data/quora-paraphrase-dev.csv
Loaded 1709 train examples from data/sts-similarity-dev.csv
------------------------------
    Multitask BERT Model Configuration
------------------------------
{'batch_size': 32,
 'batch_size_para': 16,
 'batch_size_sst': 16,
 'batch_size_sts': 16,
 'beta_vaccine': 0.01,
 'combine_strategy': 'force',
 'epochs': 10,
 'filepath': 'models1/multitask_classifier/20240823-121651-finetune-10.pt',
 'gradient_accumulations_para': 2,
 'gradient_accumulations_sst': 2,
 'gradient_accumulations_sts': 2,
 'hidden_dropout_prob': 0.2,
 'local_files_only': True,
 'logdir': 'logs/',
 'lr': 5e-06,
 'max_batch_size_para': 16,
 'max_batch_size_sst': 16,
 'max_batch_size_sts': 16,
 'model_name': 'bert-base',
 'n_hidden_layers': 1,
 'name': '20240823-121651-finetune-10',
 'no_tensorboard': False,
 'no_train_classifier': False,
 'num_batches_per_epoch': 300,
 'option': 'finetune',
 'patience': 5,
 'projection': 'none',
 'samples_per_epoch': None,
 'save_loss_acc_logs': False,
 'seed': 11711,
 'smart_weight_regularization': 0.01,
 'smoketest': False,
 'task_scheduler': 'pal',
 'tensorboard_subfolder': None,
 'use_amp': True,
 'use_gpu': True,
 'use_pal': False,
 'use_smart_regularization': True}
------------------------------
Git Branch: BERT_PALs-Aly
Git Hash: e9f21d7f (!)
------------------------------------------------------------
Command: train_multitask_pal.py --option finetune --use_gpu --local_files_only --smoketest --no_tensorboard --no_train_classifier --use_smart_regularization --use_pal --use_amp
------------------------------

--------------------------------------------------------------------------------
number of learnable parameters: 111259399
total number of parameters: 111259399
--------------------------------------------------------------------------------

Saving the model to models1/multitask_classifier/20240823-121651-finetune-10.pt.
Model saved to  models1/multitask_classifier/20240823-121651-finetune-10.pt
Num batches SST: 22
Num batches Para: 266
Num batches STS: 12

Train Loss SST: 3.1823841441761362
Train Loss Para: 1.2915973121062256
Train Loss STS: 14.49858291943868

Dev Accuracy SST: 0.2566596194503171
Dev Accuracy Para: 0.71250616674889
Dev Accuracy STS: 0.02564191841717876

Mean Dev Accuracy: 0.33160256820546197
Best Dev Accuracy: 0.33160256820546197
best_dev_accuracies: 0.2566596194503171
best_dev_accuracies: 0.71250616674889
best_dev_accuracies: 0.02564191841717876
Last improvement: 0

Saving the model to models1/multitask_classifier/20240823-121651-finetune-10.pt.
Model saved to  models1/multitask_classifier/20240823-121651-finetune-10.pt
Num batches SST: 15
Num batches Para: 272
Num batches STS: 13

Train Loss SST: 3.1616800944010417
Train Loss Para: 0.9945946353323319
Train Loss STS: 8.934787566845234

Dev Accuracy SST: 0.2566596194503171
Dev Accuracy Para: 0.7415145535273804
Dev Accuracy STS: 0.21230416111933306

Mean Dev Accuracy: 0.40349277803234357
Best Dev Accuracy: 0.40349277803234357
best_dev_accuracies: 0.2566596194503171
best_dev_accuracies: 0.7415145535273804
best_dev_accuracies: 0.21230416111933306
Last improvement: 1

Saving the model to models1/multitask_classifier/20240823-121651-finetune-10.pt.
Model saved to  models1/multitask_classifier/20240823-121651-finetune-10.pt
Num batches SST: 23
Num batches Para: 259
Num batches STS: 18

Train Loss SST: 3.191431460173234
Train Loss Para: 0.8903662748778649
Train Loss STS: 5.3758422003851996

Dev Accuracy SST: 0.25750528541226214
Dev Accuracy Para: 0.7874198322644302
Dev Accuracy STS: 0.6184082370448886

Mean Dev Accuracy: 0.5544444515738604
Best Dev Accuracy: 0.5544444515738604
best_dev_accuracies: 0.25750528541226214
best_dev_accuracies: 0.7874198322644302
best_dev_accuracies: 0.6184082370448886
Last improvement: 2

Saving the model to models1/multitask_classifier/20240823-121651-finetune-10.pt.
Model saved to  models1/multitask_classifier/20240823-121651-finetune-10.pt
Num batches SST: 28
Num batches Para: 247
Num batches STS: 25

Train Loss SST: 3.15521240234375
Train Loss Para: 0.8722165850733938
Train Loss STS: 3.597122926712036

Dev Accuracy SST: 0.2828752642706131
Dev Accuracy Para: 0.8073507646768624
Dev Accuracy STS: 0.7591585142794673

Mean Dev Accuracy: 0.6164615144089809
Best Dev Accuracy: 0.6164615144089809
best_dev_accuracies: 0.2828752642706131
best_dev_accuracies: 0.8073507646768624
best_dev_accuracies: 0.7591585142794673
Last improvement: 3

Saving the model to models1/multitask_classifier/20240823-121651-finetune-10.pt.
Model saved to  models1/multitask_classifier/20240823-121651-finetune-10.pt
Num batches SST: 35
Num batches Para: 224
Num batches STS: 41

Train Loss SST: 3.1552342006138394
Train Loss Para: 0.8121711260506085
Train Loss STS: 2.1097408940152422

Dev Accuracy SST: 0.31797040169133195
Dev Accuracy Para: 0.8032560434139122
Dev Accuracy STS: 0.8008470429148608

Mean Dev Accuracy: 0.6406911626733683
Best Dev Accuracy: 0.6406911626733683
best_dev_accuracies: 0.31797040169133195
best_dev_accuracies: 0.8032560434139122
best_dev_accuracies: 0.8008470429148608
Last improvement: 4

Saving the model to models1/multitask_classifier/20240823-121651-finetune-10.pt.
Model saved to  models1/multitask_classifier/20240823-121651-finetune-10.pt
Num batches SST: 39
Num batches Para: 226
Num batches STS: 35

Train Loss SST: 3.149260692107372
Train Loss Para: 0.8084918517718273
Train Loss STS: 1.7394410031182426

Dev Accuracy SST: 0.2752642706131078
Dev Accuracy Para: 0.8201282683769117
Dev Accuracy STS: 0.834273416637523

Mean Dev Accuracy: 0.6432219852091808
Best Dev Accuracy: 0.6432219852091808
best_dev_accuracies: 0.2752642706131078
best_dev_accuracies: 0.8201282683769117
best_dev_accuracies: 0.834273416637523
Last improvement: 5

Saving the model to models1/multitask_classifier/20240823-121651-finetune-10.pt.
Model saved to  models1/multitask_classifier/20240823-121651-finetune-10.pt
Num batches SST: 54
Num batches Para: 194
Num batches STS: 52

Train Loss SST: 3.1378792656792536
Train Loss Para: 0.814082111279989
Train Loss STS: 1.4151794486320937

Dev Accuracy SST: 0.35560253699788585
Dev Accuracy Para: 0.822940305870745
Dev Accuracy STS: 0.8475321864165731

Mean Dev Accuracy: 0.675358343095068
Best Dev Accuracy: 0.675358343095068
best_dev_accuracies: 0.35560253699788585
best_dev_accuracies: 0.822940305870745
best_dev_accuracies: 0.8475321864165731
Last improvement: 6

Saving the model to models1/multitask_classifier/20240823-121651-finetune-10.pt.
Model saved to  models1/multitask_classifier/20240823-121651-finetune-10.pt
Num batches SST: 60
Num batches Para: 189
Num batches STS: 51

Train Loss SST: 2.9549296061197916
Train Loss Para: 0.7704452038126648
Train Loss STS: 1.3322986656544256

Dev Accuracy SST: 0.4249471458773784
Dev Accuracy Para: 0.8111741489886531
Dev Accuracy STS: 0.8531473442718517

Mean Dev Accuracy: 0.6964228797126277
Best Dev Accuracy: 0.6964228797126277
best_dev_accuracies: 0.4249471458773784
best_dev_accuracies: 0.8111741489886531
best_dev_accuracies: 0.8531473442718517
Last improvement: 7

Saving the model to models1/multitask_classifier/20240823-121651-finetune-10.pt.
Model saved to  models1/multitask_classifier/20240823-121651-finetune-10.pt
Num batches SST: 75
Num batches Para: 152
Num batches STS: 73

Train Loss SST: 2.7571720377604167
Train Loss Para: 0.7756169626587316
Train Loss STS: 1.2529052479626381

Dev Accuracy SST: 0.440169133192389
Dev Accuracy Para: 0.8285150468672916
Dev Accuracy STS: 0.8617003653091766

Mean Dev Accuracy: 0.710128181789619
Best Dev Accuracy: 0.710128181789619
best_dev_accuracies: 0.440169133192389
best_dev_accuracies: 0.8285150468672916
best_dev_accuracies: 0.8617003653091766
Last improvement: 8

Saving the model to models1/multitask_classifier/20240823-121651-finetune-10.pt.
Model saved to  models1/multitask_classifier/20240823-121651-finetune-10.pt
Num batches SST: 81
Num batches Para: 137
Num batches STS: 82

Train Loss SST: 2.564011562017747
Train Loss Para: 0.7613248972997179
Train Loss STS: 0.9449356699862131

Dev Accuracy SST: 0.4503171247357294
Dev Accuracy Para: 0.8309324124321658
Dev Accuracy STS: 0.8652129975408922

Mean Dev Accuracy: 0.7154875115695957
Best Dev Accuracy: 0.7154875115695957
best_dev_accuracies: 0.4503171247357294
best_dev_accuracies: 0.8309324124321658
best_dev_accuracies: 0.8652129975408922
Last improvement: 9

Loaded model to test from models1/multitask_classifier/20240823-121651-finetune-10.pt
Loaded 2371 test examples from data/sst-sentiment-test-student.csv
Loaded 40540 test examples from data/quora-paraphrase-test-student.csv
Loaded 1721 test examples from data/sts-similarity-test-student.csv
Loaded 2365 dev examples from data/sst-sentiment-dev.csv
Loaded 40540 dev examples from data/quora-paraphrase-dev.csv
Loaded 1709 dev examples from data/sts-similarity-dev.csv
dev sentiment acc :: 0.45032
dev paraphrase acc :: 0.83093
dev sts corr :: 0.86521
Mean accuracy :: 0.71549
============ Job Information ===================================================
Submitted: 2024-08-23T12:15:39
Started: 2024-08-23T12:16:17
Ended: 2024-08-23T12:38:17
Elapsed: 22 min, Limit: 900 min, Difference: 878 min
CPUs: 128, Nodes: 1
Estimated Consumption: 440.00 core-hours
================================================================================
